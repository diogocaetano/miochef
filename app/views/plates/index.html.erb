<div class="row">
  <div class="col-lg-12">
    <a href="/plates/new">
        <button type="button" class="btn btn-primary">Adicionar Prato</button>
    </a>
    <div class="panel"></div>
    <section class="panel">
      <header class="panel-heading">
          Pratos
      </header>
      <div class="panel-body">
        <section id="unseen">
          <table class="table table-bmoduleed table-striped table-condensed">
            <thead>
              <tr>
                                  <th>Título</th>
                                  <th>Descrição</th>
                                  <th>Preço</th>
                                  <th>Quantidade Disponível</th>
                                  <th>Foto</th>
                                  <th>Tipo de Prato</th>
                                <th colspan='3'>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @plates.each do |plate| %>
                <tr>
                                      <td><%= plate.title %></td>
                                      <td><%= plate.description %></td>
                                      <td><%= number_to_currency(plate.price, unit: "R$", separator: ",", delimiter: ".") %></td>
                                      <td><%= plate.available_quantity %></td>
                                      <td><%= image_tag(plate.photo.url(:thumb), size: "34x34") %></td>
                                      <td><%= plate.plate_type.name %></td>
                                    <td>
                    <!-- ATIVAR/DESATIVAR -->
                    <% if plate.active == 1 %>
                      <%= link_to raw("<i class='fa fa-power-off'></i>"), '#deactivate_plate_'+plate.id.to_s, :class => 'btn btn-danger', :'data-toggle' => 'modal'  %>
                    <% else %>
                      <%= link_to raw("<i class='fa fa-power-off'></i>"), '#activate_plate_'+plate.id.to_s, :class => 'btn btn-success', :'data-toggle' => 'modal'  %>
                    <% end %>
                    <!-- FIM ATIVAR/DESATIVAR -->
                    <%= link_to raw("<i class='fa fa-calendar'></i>"), '#daily_menu_'+plate.id.to_s, :class => 'btn btn-warning', :'data-toggle' => 'modal'  %>
                    <%= link_to raw("<i class='fa fa-eye'></i>"), plate, :class => 'btn btn-primary' %>
                    <%= link_to raw("<i class='fa fa-pencil'></i>"), edit_plate_path(plate), :class => 'btn btn-info' %>
                    <%= link_to raw("<i class='fa fa-trash-o'></i>"), '#delete_plate_'+plate.id.to_s, :class => 'btn btn-danger', :'data-toggle' => 'modal'  %>
                  </td>
                </tr>
                <!-- MODAL DELETE -->
                <div class="modal fade modal-dialog-center in" id="delete_plate_<%= plate.id.to_s %>"
                  tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                  <div class="modal-backdrop fade in" style="height: 749px;">
                  </div>
                  <div class="modal-dialog ">
                    <div class="modal-content-wrap">
                      <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title">Remover Prato</h4>
                        </div>
                        <div class="modal-body">
                          <div class="text-center">
                            Deseja Realmente Remover o Prato
                          </div>
                        </div>
                        <div class="modal-footer">
                          <div class="pull-left">
                            <button data-dismiss="modal" class="btn btn-default" type="button">Fechar</button>
                          </div>
                          <%= link_to raw("Confirmar"), plate, :class => 'btn btn-primary', :'data-method' => 'delete' %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <% if plate.active == 1 %>
                  <!-- MODAL DEACTIVATE -->
                  <div class="modal fade modal-dialog-center in" id="deactivate_plate_<%= plate.id.to_s %>"
                    tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                    <div class="modal-backdrop fade in" style="height: 749px;">
                    </div>
                    <div class="modal-dialog ">
                      <div class="modal-content-wrap">
                        <div class="modal-content">
                          <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                              <h4 class="modal-title">Desativar Prato</h4>
                          </div>
                          <div class="modal-body">
                            <div class="text-center">
                              Deseja Realmente Desativar o Prato?
                            </div>
                          </div>
                          <div class="modal-footer">
                            <div class="pull-left">
                              <button data-dismiss="modal" class="btn btn-default" type="button">Fechar</button>
                            </div>
                            <%= link_to "Confirmar", plate_deactivate_path(plate), :method => :post, :class => 'btn btn-primary' %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <!-- MODAL ACTIVATE -->
                  <div class="modal fade modal-dialog-center in" id="activate_plate_<%= plate.id.to_s %>"
                    tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                    <div class="modal-backdrop fade in" style="height: 749px;">
                    </div>
                    <div class="modal-dialog ">
                      <div class="modal-content-wrap">
                        <div class="modal-content">
                          <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                              <h4 class="modal-title">Ativar Prato</h4>
                          </div>
                          <div class="modal-body">
                            <div class="text-center">
                              Deseja Realmente Ativar o Prato?
                            </div>
                          </div>
                          <div class="modal-footer">
                            <div class="pull-left">
                              <button data-dismiss="modal" class="btn btn-default" type="button">Fechar</button>
                            </div>
                            <%= link_to "Confirmar", plate_activate_path(plate), :method => :post, :class => 'btn btn-primary' %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
                <!-- MODAL DAILY MENU -->
                  <div class="modal fade modal-dialog-center in" id="daily_menu_<%= plate.id.to_s %>"
                    tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                    <div class="modal-backdrop fade in" style="height: 749px;">
                    </div>
                    <div class="modal-dialog ">
                      <div class="modal-content-wrap">
                        <div class="modal-content">
                          <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                              <h4 class="modal-title">Adicionar ao Cardápio do Dia</h4>
                          </div>
                          <div class="modal-body">
                            <div class="panel-body">
                            <%= form_for plate, :url => plate_daily_menu_path(plate), :method => :post do |f| %>
                              <div class="form-group">
                                <%= f.label :price %><br>
                                <%= f.text_field 'price_mask', :value => number_to_currency(plate.price, unit: "R$", separator: ",", delimiter: "."), :class => 'form-control currency', :data => { 'prefix' => 'R$ ', 'thousands' => '.', 'decimal' => ',', 'group' => 'group_plate_' + plate.id.to_s} %>
                                <input type="hidden" id="plate[price]" name="plate[price]" value="<%= plate.price.to_s %>" data-group="group_plate_<%= plate.id %>" >
                              </div>

                              <div class="form-group">
                                <%= f.label :available_quantity %>
                                <%= number_field_tag 'plate[available_quantity]',  plate.available_quantity.to_s, class: 'form-control', min: 0 %>
                              </div>

                              <div class="form-group">
                                <%= check_box_tag "plate[sunday_available]", 1, plate.sunday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :sunday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[monday_available]", 1, plate.monday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :monday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[tuesday_available]", 1, plate.tuesday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :tuesday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[wednesday_available]", 1, plate.wednesday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :wednesday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[thursday_available]", 1, plate.thursday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :thursday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[friday_available]", 1, plate.friday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :friday_available %>
                              </div>
                              <div class="form-group">
                                <%= check_box_tag "plate[saturday_available]", 1, plate.saturday_available == 1, {class: 'group_plate_' + plate.id.to_s} %>
                                <%= f.label :saturday_available %>
                              </div>
                              <div class="form-group">
                                <input type="checkbox" class="deselecting_all" name="group_plate_<%= plate.id.to_s %>">
                                <%= f.label "Desmarcar todos" %>
                              </div>
                            </div>
                          </div>
                          <div class="modal-footer">
                            <div class="pull-left">
                              <button data-dismiss="modal" class="btn btn-default" type="button">Fechar</button>
                            </div>
                            <div class="form-group">
                              <%= f.submit 'Salvar', :class => 'btn btn-primary' %>
                            </div>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- FIM MODAL DAILY MENU -->
              <% end -%>
            </tbody>
          </table>
        </section>
      </div>
    </section>
  </div>
</div>

<script type="text/javascript">
  window.addEventListener('load', function(){
    $('.currency').maskMoney();

    $('.currency').keyup(function(e){
      var group = $(this).data('group');
      $('input[type="hidden"][data-group="' + group + '"]').val(($(this).maskMoney('unmasked')[0]));
      console.log($('input[type="hidden"][data-group="' + group + '"]').val());
    });

    $('.deselecting_all').on('change', function(){
      if (this.checked) {
        var group = $(this).attr('name');
        $('[class=' + group + ']').removeAttr('checked');
      }
    });
  });
</script>